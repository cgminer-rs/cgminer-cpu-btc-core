//! # å¹³å°ç‰¹å®šä¼˜åŒ–æ¨¡å—
//!
//! æœ¬æ¨¡å—æä¾›è·¨å¹³å°çš„CPUæŒ–çŸ¿ä¼˜åŒ–åŠŸèƒ½ï¼Œé’ˆå¯¹ä¸åŒæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶æ¶æ„
//! æä¾›ç‰¹å®šçš„ä¼˜åŒ–ç­–ç•¥ï¼Œä»¥æœ€å¤§åŒ–CPUæŒ–çŸ¿æ€§èƒ½ã€‚
//!
//! ## ğŸš€ å¹³å°ä¼˜åŒ–ç‰¹æ€§
//!
//! ### CPUè®©å‡ºç­–ç•¥ä¼˜åŒ–
//! - ğŸ”§ **macOS**: 1000æ¬¡å“ˆå¸Œ/è®©å‡º (ä¼˜åŒ–å“åº”æ€§)
//! - ğŸ”§ **Linux**: 2000æ¬¡å“ˆå¸Œ/è®©å‡º (å¹³è¡¡æ€§èƒ½ä¸å“åº”)
//! - ğŸ”§ **Windows**: 1500æ¬¡å“ˆå¸Œ/è®©å‡º (å…¼å®¹æ€§ä¼˜å…ˆ)
//! - ğŸ”§ **å…¶ä»–å¹³å°**: 1000æ¬¡å“ˆå¸Œ/è®©å‡º (ä¿å®ˆç­–ç•¥)
//!
//! ### é«˜æ€§èƒ½æ”¯æŒæ£€æµ‹
//! - âœ… **x86_64**: å®Œå…¨æ”¯æŒï¼ŒåŒ…æ‹¬SIMDä¼˜åŒ–
//! - âœ… **aarch64**: å®Œå…¨æ”¯æŒï¼ŒARM64ä¼˜åŒ–
//! - âš ï¸ **å…¶ä»–æ¶æ„**: åŸºç¡€æ”¯æŒï¼Œæ€§èƒ½å¯èƒ½å—é™
//!
//! ## ğŸ“Š æ€§èƒ½è°ƒä¼˜å‚æ•°
//!
//! | å¹³å° | è®©å‡ºé¢‘ç‡ | ä¼˜åŒ–é‡ç‚¹ | ç‰¹æ®Šè€ƒè™‘ |
//! |------|----------|----------|----------|
//! | macOS | 1000 | å“åº”æ€§ | ç³»ç»Ÿè°ƒåº¦ä¼˜åŒ– |
//! | Linux | 2000 | ååé‡ | å†…æ ¸è°ƒåº¦é…åˆ |
//! | Windows | 1500 | å…¼å®¹æ€§ | å¤šç‰ˆæœ¬æ”¯æŒ |
//! | å…¶ä»– | 1000 | ç¨³å®šæ€§ | ä¿å®ˆé…ç½® |
//!
//! ## ğŸ¯ è®¾è®¡ç›®æ ‡
//!
//! 1. **è·¨å¹³å°å…¼å®¹**: ç»Ÿä¸€APIï¼Œå¹³å°ç‰¹å®šå®ç°
//! 2. **æ€§èƒ½æœ€ä¼˜**: é’ˆå¯¹æ¯ä¸ªå¹³å°çš„ç‰¹æ€§ä¼˜åŒ–
//! 3. **ç®€å•æ˜“ç”¨**: æœ€å°åŒ–é…ç½®ï¼Œè‡ªåŠ¨æ£€æµ‹
//! 4. **å‘åå…¼å®¹**: æ”¯æŒæœªçŸ¥å¹³å°çš„é™çº§å¤„ç†
//!
//! ## ğŸ”„ ä½¿ç”¨ç¤ºä¾‹
//!
//! ```rust
//! use cgminer_cpu_btc_core::platform_optimization;
//!
//! // è·å–å¹³å°ä¿¡æ¯
//! let platform_info = platform_optimization::get_platform_info();
//! println!("è¿è¡Œå¹³å°: {}", platform_info);
//!
//! // æ£€æŸ¥é«˜æ€§èƒ½æ”¯æŒ
//! if platform_optimization::supports_high_performance() {
//!     println!("âœ… å½“å‰å¹³å°æ”¯æŒé«˜æ€§èƒ½ä¼˜åŒ–");
//! }
//!
//! // åœ¨æŒ–çŸ¿å¾ªç¯ä¸­ä½¿ç”¨
//! for i in 0..batch_size {
//!     // æ‰§è¡Œå“ˆå¸Œè®¡ç®—
//!     let hash = calculate_hash(&data);
//!
//!     // å¹³å°ç‰¹å®šçš„CPUè®©å‡º
//!     if i % platform_optimization::get_platform_yield_frequency() == 0 {
//!         tokio::task::yield_now().await;
//!     }
//! }
//! ```

/// è·å–å¹³å°ç‰¹å®šçš„CPUè®©å‡ºé¢‘ç‡
///
/// è¿™ä¸ªå‡½æ•°åœ¨æŒ–çŸ¿å¾ªç¯ä¸­è¢«ä½¿ç”¨ï¼Œç”¨äºä¼˜åŒ–CPUè®©å‡ºç­–ç•¥
pub fn get_platform_yield_frequency() -> u64 {
    // æ ¹æ®å¹³å°è¿”å›åˆé€‚çš„è®©å‡ºé¢‘ç‡
    #[cfg(target_os = "macos")]
    {
        1000 // macOS: æ¯1000æ¬¡å“ˆå¸Œè®©å‡ºä¸€æ¬¡
    }

    #[cfg(target_os = "linux")]
    {
        2000 // Linux: æ¯2000æ¬¡å“ˆå¸Œè®©å‡ºä¸€æ¬¡
    }

    #[cfg(target_os = "windows")]
    {
        1500 // Windows: æ¯1500æ¬¡å“ˆå¸Œè®©å‡ºä¸€æ¬¡
    }

    #[cfg(not(any(target_os = "macos", target_os = "linux", target_os = "windows")))]
    {
        1000 // å…¶ä»–å¹³å°: ä¿å®ˆçš„è®©å‡ºé¢‘ç‡
    }
}

/// è·å–å¹³å°ä¿¡æ¯å­—ç¬¦ä¸²ï¼ˆç”¨äºæ—¥å¿—è¾“å‡ºï¼‰
pub fn get_platform_info() -> String {
    format!("{}-{}",
            std::env::consts::OS,
            std::env::consts::ARCH)
}

/// æ£€æŸ¥å½“å‰å¹³å°æ˜¯å¦æ”¯æŒé«˜æ€§èƒ½ä¼˜åŒ–
pub fn supports_high_performance() -> bool {
    // ç®€åŒ–çš„å¹³å°æ£€æŸ¥
    cfg!(any(target_arch = "x86_64", target_arch = "aarch64"))
}
